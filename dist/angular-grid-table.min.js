/*!
 * angular-grid-table
 * @version: 0.0.1 - 2015-04-17T07:23:37.327Z
 * @author: Alex Elenvarenko <alexelenvarenko@gmail.com>
 * @license: MIT
 */
!function(){"use strict";var t=angular.module("gridTable",[]);t.constant("gridTableConfig",{tplUrl:""}),t.controller("gridTableCtrl",["$scope","$compile","$parse","$filter","$interval","gridTablePager",function(t,e,n,i,r,s){var l=this;t.$grid={defaults:{template:"{toolbar}{header}{items}{footer}",sorted:!1,multiSort:!1,sortParams:{asc:"asc",desc:"desc"},pageParams:{page:"page",perPage:"per-page"},filtered:!1,filterTimeout:500,multiSelect:!1,viewByList:[10,25,50],text:{viewBy:"View by: ",numbers:"#",actions:"Actions",asc:"⇣",desc:"⇡",empty:"Empty",total:"Total: "}},debug:!1,remote:!1,loading:!1,ngModelVar:"",columns:[],columnsCount:0,hiddenColumns:[],items:[],itemsCount:0,itemActions:null,rowNumbers:!1,multiSelect:!1,selected:null,sorted:!1,multiSort:!1,sort:{},filtered:!1,filters:null,filter:{},filterTimeoutId:null,filterTimeout:500,viewBy:10,viewByList:[10,25,50],pager:{current:0,total:0,limit:0,offset:0,items:[]},params:{},paramsVars:{},errors:null,events:{onColumnsUpdate:null,onItemsUpdate:null,onViewBy:null,onPage:null,onSelect:null,onSort:null,onFilter:null,onParams:null,onUpdate:null,onError:null},text:{},buildColumns:function(t,e){var n;if(this.columns=[],this.columnsCount=0,this.rowNumbers&&this.columns.push({columnType:"numbers"}),t)if(angular.isArray(t)&&t.length>0)for(var i in t)n=t[i],n.columnType="data",this.columns.push(n);else for(var r in t)n=t[r],n.columnType="data",this.columns.push(n);if(e)for(var r in e)"$$hashKey"!==r&&this.columns.push({name:r,label:r,columnType:"data"});this.itemActions&&this.columns.push({columnType:"actions"}),this.columnsCount=this.columns.length},setColumns:function(t){t&&(this.buildColumns(t),this.triggerEvent("onColumnsUpdate"))},setColumnsByModel:function(t){t&&(this.buildColumns(null,t),this.triggerEvent("onColumnsUpdate"))},getColumns:function(){return this.columns||[]},isHiddenColumns:function(t){return-1!==this.hiddenColumns.indexOf(t)},showHideColumn:function(t,e){e.preventDefault(),t?this.isHiddenColumns(t)?this.hiddenColumns.splice(this.hiddenColumns.indexOf(t),1):this.hiddenColumns.push(t):this.hiddenColumns=[]},getShowColumns:function(){var t=[];for(var e in this.columns)this.isHiddenColumns(this.columns[e].name)&&"data"===this.columns[e].columnType||t.push(this.columns[e]);return t},setItems:function(t){if(!t)return void(this.items=[]);if(!this.remote){if(this.sort.column&&this.sort.dir){var e=this.sort;t=t.sort(function(t,n){var i=t[e.column],r=n[e.column];return"asc"===e.dir?r>i?-1:i>r?1:0:r>i?1:i>r?-1:0})}this.filter&&(t=i("filter")(t,this.filter)),this.pager.total=t.length,this.pager.current>Math.ceil(this.pager.total/this.viewBy)&&(this.pager.current=Math.ceil(this.pager.total/this.viewBy)-1)}this.pager.items=s.createItems(this.pager.current,this.viewBy,this.pager.total),this.items=this.remote?t:t.slice(this.pager.current*this.viewBy,(this.pager.current+1)*this.viewBy),this.itemsCount=this.items.length||0,this.triggerEvent("onItemsUpdate")},getItems:function(){return this.items||[]},isSelectedItem:function(t){if(this.selected){if(!this.multiSelect)return this.selected===t;if(angular.isArray(this.selected)&&this.selected.length>0)return-1!==this.selected.indexOf(t)}return!1},selectItem:function(t){if(!t)return void(this.selected=null);var e=this.isSelectedItem(t);this.multiSelect?e?this.selected.splice(this.selected.indexOf(t),1):angular.isArray(this.selected)?this.selected.push(t):this.selected=[t]:this.selected=e?null:t,this.triggerEvent("onSelect")},callItemAction:function(t,e,n){n.preventDefault(),n.stopPropagation(),t(e)},setPage:function(t,e){e.preventDefault(),this.pager.current!=t&&(this.pager.current=t,this.pager.limit=this.viewBy,this.pager.offset=this.pager.current*this.pager.limit,this.updateParams(),this.triggerEvent("onPage"),this.update())},getPage:function(){return this.pager.current||0},setViewBy:function(t,e){e.preventDefault(),this.viewBy!=t&&(this.viewBy=t,this.updateParams(),this.triggerEvent("onViewBy"),this.update())},getViewBy:function(){return this.viewBy},setSort:function(t){this.sort=t,this.triggerEvent("onSort"),this.update()},getSort:function(){return this.sort||{}},setSortBy:function(t,e,n){n.preventDefault(),this.sort.column===t?this.sort.dir="asc"===this.sort.dir?"desc":"asc":this.sort={column:t,dir:e?e:"asc"},this.updateParams(),this.triggerEvent("onSort"),this.update()},getSortColumn:function(){return this.sort.column||null},getSortDir:function(){return this.sort.dir||null},setFilter:function(t){this.filter=t,this.triggerEvent("onFilter")},getFilter:function(){return this.filter},setFilterBy:function(){var t=this;this.filterTimeoutId||(this.filterTimeoutId=r(function(){t.updateParams(),t.triggerEvent("onFilter"),t.update()},this.filterTimeout))},getFilterColumn:function(){},getFilterColumnValue:function(t){return this.filter[t]||null},setParams:function(t){t.viewBy&&(this.viewBy=t.viewBy),t.pager&&(this.pager.current=t.pager.current,this.pager.total=t.pager.total),t.sort&&(this.sort.column=t.sort.column,this.sort.dir=t.sort.dir),this.update()},getParams:function(){return this.params},updateParams:function(){this.params={},this.sort.column&&(this.params.sort=("asc"==this.sort.dir?"":"-")+(this.sort.column?this.sort.column:"")),this.params.page=this.pager.current+1,this.params.perPage=this.viewBy,this.params=angular.extend(this.params,this.filter),this.triggerEvent("onParams")},update:function(){this.remote&&(this.loading=!0),this.filterTimeoutId&&(r.cancel(this.filterTimeoutId),this.filterTimeoutId=null),this.setItems(n(t.$grid.ngModelVar)(t)),this.remote&&(this.loading=!1)},addEvent:function(t,e){(t||e)&&null===this.events[t]&&(this.events[t]=e)},triggerEvent:function(t,e){t&&this[t](e)},removeEvent:function(t){t&&this.events[t]&&(this.events[t]=null)},onColumnsUpdate:function(){null!==this.events.onColumnsUpdate&&angular.isFunction(this.events.onColumnsUpdate)&&this.events.onColumnsUpdate(this.columns)},onItemsUpdate:function(){null!==this.events.onItemsUpdate&&angular.isFunction(this.events.onItemsUpdate)&&this.events.onItemsUpdate(this.items)},onSelect:function(){null!==this.events.onSelect&&angular.isFunction(this.events.onSelect)&&this.events.onSelect(this.selected)},onViewBy:function(){null!==this.events.onViewBy&&angular.isFunction(this.events.onViewBy)&&this.events.onViewBy(this.viewBy)},onPage:function(){null!==this.events.onPage&&angular.isFunction(this.events.onPage)&&this.events.onPage(this.pager)},onSort:function(){null!==this.events.onSort&&angular.isFunction(this.events.onSort)&&this.events.onSort(this.sort)},onFilter:function(){null!==this.events.onFilter&&angular.isFunction(this.events.onFilter)&&this.events.onFilter(this.filter)},onParams:function(){null!==this.events.onParams&&angular.isFunction(this.events.onParams)&&this.events.onParams(this.params)},onUpdate:function(){null!==this.events.onUpdate&&angular.isFunction(this.events.onUpdate)&&this.events.onUpdate(this.items,this.columns,this.pager,this.viewBy,this.sort,this.filter)},onError:function(){null!==this.events.onError&&angular.isFunction(this.events.onError)&&this.events.onError(this.errors)}},l.init=function(e,i){if(i.settings,i.debug&&(t.$grid.debug=i.debug),i.remote&&(t.$grid.remote=n(i.remote)(t)),i.ngModel&&(t.$grid.ngModelVar=i.ngModel),i.filters&&(t.$grid.filters=n(i.filters)(t)),i.actions&&(t.$grid.itemActions=n(i.actions)(t)),i.rowNumbers&&(t.$grid.rowNumbers=i.rowNumbers),i.text){var r=n(i.text)(t);t.$grid.text=angular.extend(t.$grid.defaults.text,r)}else t.$grid.text=t.$grid.defaults.text;for(var s in t.$grid.events)if(i[s]&&null===t.$grid.events[s]){var l=n(i[s])(t);l&&angular.isFunction(l)&&(t.$grid.events[s]=l)}},l.loadSetting=function(){},l.renderTpl=function(e,n){var i=n.template||t.$grid.defaults.template,r=i.match(/\{[a-z\:]+\}/g);if(r&&r.length>0)for(var s in r){var a=r[s].replace(/\{|\}/g,""),o=null;-1!==a.indexOf(":")&&(o=a.split(":"),a=o.splice(0,1)[0]),a="render"+a[0].toUpperCase()+a.substr(1),l[a]&&angular.isFunction(l[a])&&(e=l[a](e,n))}return e},l.renderToolbar=function(t){var e=angular.element(document.createElement("div"));return e.addClass("grid-table-toolbar"),e.attr({"grid-table-toolbar":""}),t.find(".grid-table-wrapper").append(e),t},l.renderTable=function(t){if(t.find("table").length>0)return t;var e=angular.element(document.createElement("table"));return e.addClass("grid-table-table"),e.attr({"ng-class":"{'loading': $grid.loading}"}),t.find(".grid-table-wrapper").append(e),t},l.renderHeader=function(t){var e=angular.element(document.createElement("colgroup")),n=angular.element(document.createElement("thead"));return e.attr({"grid-table-columns":""}),e.addClass("grid-table-columns"),n.attr({"grid-table-header":""}),n.addClass("grid-table-header"),t=this.renderTable(t),t.find("table").append(e),t.find("table").append(n),t},l.renderItems=function(t){var e=angular.element(document.createElement("tbody"));return e.attr({"grid-table-items":""}),e.addClass("grid-table-items"),t=this.renderTable(t),t.find("table").append(e),t},l.renderFooter=function(t){var e=angular.element(document.createElement("tfoot"));return e.attr({"grid-table-footer":""}),e.addClass("grid-table-footer"),t=this.renderTable(t),t.find("table").append(e),t},l.compileTpl=function(t,n){e(n.contents())(t)},l.setLoading=function(e){t.$grid.loading=e?!0:!1},l.setColumns=function(e){t.$grid.setColumns(e)},l.setColumnsByModel=function(e){t.$grid.setColumnsByModel(e)},l.getColumns=function(){return t.$grid.getColumns()||[]},l.setItems=function(e){t.$grid.setItems(e)},l.getItems=function(){return t.$grid.getItems()},l.setPager=function(e){t.$grid.pager=e},l.getPager=function(){return t.$grid.pager},l.setViewBy=function(e){t.$grid.viewBy=e},l.getViewBy=function(){return t.$grid.viewBy},l.setSort=function(e){t.$grid.sort=e},l.getSort=function(){return t.$grid.sort},l.setFilter=function(e){t.$grid.filter=e},l.getFilter=function(){return t.$grid.filter},l.setParams=function(e){t.$grid.setParams(e)},l.getParams=function(){return t.$grid.params}}]),t.factory("gridTableColumn",[function(){return{}}]),t.factory("gridTablePager",[function(){return{createItems:function(t,e,n){if(n&&0>=n)return[];var i=[],r=Math.ceil(n/e),s=0,l=0;r>5&&t>0&&(i.push({label:"<<",index:0,disable:0>=t}),i.push({label:"<",index:0>=t?0:t-1,disable:0===t})),3>t&&(s=0,l=5),t>r-1&&(s=t-2,l=s+5),t>r-4&&(s=r-5,l=r),r-2>t&&t>2&&(s=t-2,l=t+3),5>r&&(s=0,l=r),1>=r&&(s=l=0);for(var a=s;l>a;a++)i.push({label:a+1,index:a});return r>5&&r-1>t&&(i.push({label:">",index:r-1>t?t+1:t,disable:t==r-1}),i.push({label:">>",index:r-1,disable:t==r-1})),i}}}]),t.factory("gridTableRemote",["$q","$http","$parse",function(){var t={url:"",method:"get",data:null,resultVar:"data.data"};return{set:function(){},get:function(e){return $q(function(n){$http({url:t.url,method:t.method.toUpperCase,data:e}).then(function(t){n(t.data)},function(t){n(t.data)})})},sync:function(){}}}]),t.factory("gridTableSettings",[function(){return{createSettings:function(){return{}}}}]),t.filter("gridTableFormater",[function(){}]),t.directive("gridTableColumns",["gridTableConfig",function(t){return{restrict:"EA",require:"^gridTable",templateUrl:function(){return t.tplUrl+"grid-table-columns.html"}}}]),t.directive("gridTableFooter",["gridTableConfig",function(t){return{restrict:"EA",require:"^gridTable",templateUrl:function(){return t.tplUrl+"grid-table-footer.html"}}}]),t.directive("gridTableHeader",["gridTableConfig",function(t){return{restrict:"EA",require:"^gridTable",templateUrl:function(){return t.tplUrl+"grid-table-header.html"}}}]),t.directive("gridTableItemAction",[function(){return{restrict:"EA",scope:{html:"=html"},link:function(t,e){e.append(t.html)}}}]),t.directive("gridTableItems",["gridTableConfig",function(t){return{restrict:"EA",require:"^gridTable",templateUrl:function(){return t.tplUrl+"grid-table-items.html"}}}]),t.directive("gridTableToolbar",["gridTableConfig",function(t){return{restrict:"EA",require:"^gridTable",templateUrl:function(){return t.tplUrl+"grid-table-toolbar.html"}}}]),t.directive("gridTable",["$parse","gridTableConfig",function(t,e){return{restrict:"EA",require:["^gridTable","^ngModel"],templateUrl:function(){return e.tplUrl+"grid-table.html"},controller:"gridTableCtrl",controllerAs:"$gridCtrl",compile:function(){return function(e,n,i,r){{var s=r[0];r[1]}if(s.init(n,i),n=s.renderTpl(n,i),s.compileTpl(e,n),i.columns)s.setColumns(t(i.columns)(e)),e.$watchCollection(i.columns,function(t,e){angular.equals(t,e)||s.setColumns(t)});else{var l=t(i.ngModel)(e);l&&l.length>0&&s.setColumnsByModel(l[0]),e.$watchCollection(i.ngModel,function(t,e){angular.equals(t,e)||t&&t.length>0&&s.setColumnsByModel(t[0])})}s.setItems(t(i.ngModel)(e)),e.$watchCollection(i.ngModel,function(t,e){angular.equals(t,e)||s.setItems(t)}),i.loading&&e.$watch(i.loading,function(t,e){angular.equals(t,e)||s.setLoading(t)}),i.params&&e.$watchCollection(i.params,function(t,e){angular.equals(t,e)||s.setParams(t)})}}}}]),t.run(["$templateCache",function(t){t.put("grid-table-columns.html",'<col ng-repeat="column in $grid.getShowColumns()" class="{{\'grid-table-column-\' + column.columnType}}">'),t.put("grid-table-footer.html",'<tr><td colspan="{{$grid.columnsCount}}">Total: {{$grid.itemsCount}}</td></tr>'),t.put("grid-table-header.html",'<tr class="grid-table-headers"><th ng-class="{\'sorted\': column.name === $grid.getSortColumn()}" ng-repeat="column in $grid.getShowColumns()"><span ng-if="column.columnType === \'data\'"><a ng-click="$grid.setSortBy(column.name, null, $event)" href="#">{{column.label}} <i>{{column.name === $grid.getSortColumn() ? ($grid.getSortDir() === \'asc\' ? $grid.text.asc : $grid.text.desc) : \'\'}}</i></a></span> <span ng-if="column.columnType === \'numbers\'">{{$grid.text.numbers}}</span> <span ng-if="column.columnType === \'actions\'">{{$grid.text.actions}}</span></th></tr><tr class="grid-table-filter"><td ng-repeat="column in $grid.getShowColumns()"><span ng-if="column.columnType === \'data\'"><span ng-if="$grid.filters[column.name]"><select ng-change="$grid.setFilterBy()" ng-model="$grid.filter[column.name]"><option value=""></option><option ng-repeat="val in $grid.filters[column.name].values" value="{{val[$grid.filters[column.name].value]}}">{{val[$grid.filters[column.name].label]}}</option></select></span> <span ng-if="!$grid.filters[column.name]"><input ng-change="$grid.setFilterBy()" ng-model="$grid.filter[column.name]"></span></span></td></tr>'),t.put("grid-table-items.html",'<tr ng-click="$grid.selectItem(item)" ng-class="{\'active\': $grid.isSelectedItem(item)}" ng-repeat="item in $grid.getItems()" ng-init="itemsIndex = $index + 1" class="grid-table-item"><td ng-repeat="column in $grid.getShowColumns()">{{column.columnType == \'numbers\' ? itemsIndex : \'\'}}{{item[column.name]}} <span ng-if="column.columnType == \'actions\' && $grid.itemActions"><span ng-click="$grid.callItemAction(action.fn, item, $event)" ng-repeat="action in $grid.itemActions" href="#">{{action.text}} <span grid-table-item-action="" html="action.html"></span></span></span></td></tr><tr><td ng-show="$grid.itemsCount <= 0" colspan="{{$grid.columnsCount}}">{{$grid.text.empty}}</td></tr>'),t.put("grid-table-toolbar.html",'<div class="grid-table-pager"><ul class="pager"><li ng-click="$grid.setPage(page.index, $event)" ng-class="{\'active\': page.index == $grid.getPage()}" ng-disabled="page.disable" ng-repeat="page in $grid.pager.items"><a href="#">{{page.label}}</a></li></ul></div><div class="grid-table-view-by"><span class="view-by-label">View by:</span><ul class="view-by"><li ng-click="$grid.setViewBy(item, $event)" ng-class="{\'active\': item == $grid.viewBy}" ng-repeat="item in $grid.viewByList"><a href="#">{{item}}</a></li></ul></div><div class="grid-table-clear"></div>'),t.put("grid-table.html",'<div class="grid-table-wrapper"></div>')}])}();